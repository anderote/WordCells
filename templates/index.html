<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>WordCell Game</title>
</head>

<body>
    <div class="start-screen">
        <h1>Welcome to WordCells!</h1>
        <p>In this game, you'll solve word-based arithmetic puzzles by entering a word that is close in meaning to the
            result of the given operation. Press "Start" to begin!</p>
        <button id="start-btn" style="display: inline-block; margin: 0 auto;">Start</button>
    </div>
    < <div class="main-content" style="display: none;">
        <h1>WordCells</h1>
        <p>Solve the word-based arithmetic puzzle by entering a word that is close in meaning to the result of the given
            operation.</p>
        <div id="puzzle"></div>
        <input type="text" id="user-word" placeholder="Enter your answer here">
        <button id="submit-btn" onclick="submitAnswer()">Submit</button>
        <button id="new-puzzle-btn" onclick="generatePuzzle()">New Puzzle</button>
        <div id="result"></div>
        <div id="score">Your WordCell Score: 0.00</div>
        </div>
        <div class="poem">
            <h2>Poem</h2>
            <p id="poem"></p>
        </div>
        <div class="history">
            <h2>History</h2>
            <ul id="history-list"></ul>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            let currentScore = 0;
            let currentResultEmbedding = [];
            let currentPuzzle = '';

            function generatePoem(puzzle_words, user_words) {
                $.post('/generate_poem', {
                    puzzle_words: puzzle_words.join(" + "),
                    user_words: JSON.stringify(user_words),
                }, data => {
                    $('#poem').text(data.poem);
                });
            }

            function generatePoemOnPuzzle(puzzleWords) {
                $.post('/generate_poem_on_puzzle', {
                    puzzle_words: puzzleWords,
                }, data => {
                    $('#poem').text(data.poem);
                });
            }

            function generatePuzzle() {
                $.getJSON('/generate_puzzle', data => {
                    $('#puzzle').text(data.puzzle);
                    currentResultEmbedding = data.result_embedding;
                    currentPuzzle = data.puzzle;
                    generatePoemOnPuzzle(data.puzzle);

                });
                $('#user-word').val('');
            }

            function submitAnswer() {
                const userInput = $('#user-word').val();
                const userWords = userInput.split(/[ ,+]+/).filter(Boolean);
                $.post('/calculate_similarity', {
                    user_words: JSON.stringify(userWords),
                    puzzle_words: currentPuzzle,
                    result_embedding: currentResultEmbedding,
                }, data => {
                    if (data.error) {
                        $('#result').text(data.error);
                    } else {
                        currentScore += data.score;
                        $('#result').text(`Similarity: ${data.similarity}`);
                        $('#score').text(`Your WordCell Score: ${currentScore.toFixed(2)}`);
                        addToHistory(currentPuzzle, userInput, data.similarity, data.score);
                    }
                    $('#user-word').val(''); // Clear the text entry box
                });
            }




            function addToHistory(puzzle, userWord, similarity, score) {
                const listItem = $('<li>').text(`Puzzle: ${puzzle}, Your Word: ${userWord}, Similarity: ${similarity}, Score: ${score}`);
                $('#history-list').append(listItem);
            }

            // Initialize the game
            $(document).ready(function () {
                $('#start-btn').on('click', function () {
                    $('.start-screen').hide();
                    $('.main-content').show();
                    generatePuzzle();
                });
            });

            $('#user-word').on('keyup', function (event) {
                if (event.key === 'Enter') {
                    submitAnswer();
                }
            });
        </script>
</body>

</html>